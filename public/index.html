<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube æ¥­é…åˆ†ææ’ç¨‹ç³»çµ±</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --red: #e63030;
            --red-dark: #b91c1c;
            --red-light: #fee2e2;
            --black: #0f0f0f;
            --gray-1: #1a1a1a;
            --gray-2: #2a2a2a;
            --gray-3: #444;
            --gray-4: #888;
            --gray-5: #ccc;
            --gray-6: #f4f4f4;
            --white: #ffffff;
            --green: #16a34a;
            --green-light: #dcfce7;
            --blue: #1d4ed8;
            --blue-light: #dbeafe;
            --shadow: 0 4px 24px rgba(0,0,0,0.10);
            --radius: 14px;
            --mono: 'Space Mono', monospace;
            --sans: 'Noto Sans TC', sans-serif;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: var(--sans);
            background: #f7f5f3;
            min-height: 100vh;
        }

        /* â”€â”€ HEADER â”€â”€ */
        .site-header {
            background: var(--black);
            padding: 0 2.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 64px;
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 2px solid var(--red);
        }
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-family: var(--mono);
            font-size: 0.95rem;
            color: var(--white);
            letter-spacing: 0.04em;
        }
        .logo-badge {
            background: var(--red);
            color: white;
            font-size: 0.7rem;
            font-weight: 700;
            padding: 2px 7px;
            border-radius: 4px;
            letter-spacing: 0.08em;
        }
        .header-status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.8rem;
            color: var(--gray-4);
            font-family: var(--mono);
        }
        .status-dot {
            width: 8px; height: 8px;
            border-radius: 50%;
            background: #22c55e;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%,100% { opacity:1; } 50% { opacity:0.4; }
        }

        /* â”€â”€ LAYOUT â”€â”€ */
        .page {
            max-width: 1280px;
            margin: 0 auto;
            padding: 2.5rem 2rem;
        }
        .page-title {
            margin-bottom: 2.5rem;
        }
        .page-title h1 {
            font-size: 2rem;
            font-weight: 700;
            color: var(--black);
            line-height: 1.2;
        }
        .page-title p {
            color: var(--gray-4);
            margin-top: 0.4rem;
            font-size: 0.95rem;
        }

        /* â”€â”€ TABS â”€â”€ */
        .tabs {
            display: flex;
            gap: 0;
            background: var(--white);
            border-radius: 10px;
            padding: 5px;
            width: fit-content;
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
        }
        .tab-btn {
            padding: 0.55rem 1.4rem;
            border: none;
            background: transparent;
            font-size: 0.9rem;
            font-family: var(--sans);
            font-weight: 500;
            color: var(--gray-4);
            border-radius: 7px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .tab-btn.active {
            background: var(--black);
            color: var(--white);
        }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* â”€â”€ CARDS â”€â”€ */
        .card {
            background: var(--white);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 2rem;
        }
        .card-title {
            font-size: 1.05rem;
            font-weight: 700;
            color: var(--black);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .card-title .icon {
            width: 32px; height: 32px;
            background: var(--red-light);
            color: var(--red);
            border-radius: 8px;
            display: flex; align-items: center; justify-content: center;
            font-size: 1rem;
        }

        /* â”€â”€ MAIN GRID â”€â”€ */
        .main-grid {
            display: grid;
            grid-template-columns: 420px 1fr;
            gap: 1.5rem;
            align-items: start;
        }
        @media (max-width: 900px) {
            .main-grid { grid-template-columns: 1fr; }
        }

        /* â”€â”€ FORM â”€â”€ */
        .form-group { margin-bottom: 1.3rem; }
        .form-group label {
            display: block;
            font-size: 0.82rem;
            font-weight: 600;
            color: var(--gray-3);
            margin-bottom: 0.4rem;
            letter-spacing: 0.03em;
            text-transform: uppercase;
        }
        .form-group .required { color: var(--red); margin-left: 2px; }
        .form-group .helper {
            font-size: 0.78rem;
            color: var(--gray-4);
            margin-top: 0.35rem;
        }
        .form-group .helper a { color: var(--blue); text-decoration: none; }
        .form-group .helper a:hover { text-decoration: underline; }

        input[type="text"], input[type="email"], input[type="password"],
        input[type="time"], textarea, select {
            width: 100%;
            padding: 0.7rem 0.9rem;
            border: 1.5px solid var(--gray-5);
            border-radius: 8px;
            font-size: 0.93rem;
            font-family: var(--sans);
            background: var(--white);
            color: var(--black);
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--red);
            box-shadow: 0 0 0 3px rgba(230,48,48,0.1);
        }
        textarea { resize: vertical; min-height: 100px; line-height: 1.6; }

        /* Password toggle */
        .input-wrap { position: relative; }
        .input-wrap input { padding-right: 2.8rem; }
        .eye-btn {
            position: absolute; right: 0.75rem; top: 50%;
            transform: translateY(-50%);
            background: none; border: none;
            cursor: pointer; color: var(--gray-4);
            font-size: 1rem; padding: 0;
            transition: color 0.2s;
        }
        .eye-btn:hover { color: var(--gray-3); }

        /* Freq/weeks selector row */
        .row-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        /* â”€â”€ BUTTONS â”€â”€ */
        .btn {
            display: inline-flex; align-items: center; justify-content: center;
            gap: 0.4rem;
            padding: 0.75rem 1.4rem;
            border: none; border-radius: 8px;
            font-size: 0.9rem; font-family: var(--sans); font-weight: 600;
            cursor: pointer; transition: all 0.18s;
            text-decoration: none;
        }
        .btn-full { width: 100%; }
        .btn-primary { background: var(--red); color: white; }
        .btn-primary:hover { background: var(--red-dark); transform: translateY(-1px); box-shadow: 0 4px 16px rgba(230,48,48,0.25); }
        .btn-primary:active { transform: translateY(0); }
        .btn-success { background: var(--green); color: white; }
        .btn-success:hover { background: #15803d; }
        .btn-danger { background: #ef4444; color: white; }
        .btn-danger:hover { background: var(--red-dark); }
        .btn-outline { background: white; color: var(--black); border: 1.5px solid var(--gray-5); }
        .btn-outline:hover { border-color: var(--black); background: var(--gray-6); }
        .btn-ghost { background: transparent; color: var(--gray-3); padding: 0.5rem 0.75rem; }
        .btn-ghost:hover { background: var(--gray-6); }
        .btn-sm { padding: 0.4rem 0.85rem; font-size: 0.8rem; border-radius: 6px; }
        .btn:disabled { opacity: 0.55; cursor: not-allowed; transform: none !important; box-shadow: none !important; }

        /* Spinner */
        .spinner {
            width: 16px; height: 16px;
            border: 2px solid rgba(255,255,255,0.35);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.7s linear infinite;
            display: none;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .btn.loading .spinner { display: block; }
        .btn.loading .btn-text { display: none; }

        /* â”€â”€ TOAST â”€â”€ */
        #toast-container {
            position: fixed; top: 80px; right: 1.5rem;
            z-index: 9999; display: flex; flex-direction: column; gap: 0.6rem;
            pointer-events: none;
        }
        .toast {
            pointer-events: auto;
            min-width: 280px; max-width: 360px;
            padding: 0.9rem 1.1rem;
            border-radius: 10px;
            font-size: 0.875rem; font-weight: 500;
            display: flex; align-items: flex-start; gap: 0.6rem;
            box-shadow: 0 8px 32px rgba(0,0,0,0.15);
            animation: slideIn 0.3s ease;
        }
        @keyframes slideIn { from { opacity:0; transform: translateX(40px); } to { opacity:1; transform: translateX(0); } }
        .toast-success { background: #f0fdf4; border: 1px solid #bbf7d0; color: #166534; }
        .toast-error   { background: #fef2f2; border: 1px solid #fecaca; color: #991b1b; }
        .toast-info    { background: #eff6ff; border: 1px solid #bfdbfe; color: #1e40af; }
        .toast-icon { font-size: 1rem; flex-shrink: 0; }
        .toast-msg { flex: 1; line-height: 1.45; }
        .toast-close { background:none; border:none; cursor:pointer; opacity:0.5; font-size:1rem; padding:0; flex-shrink:0; }
        .toast-close:hover { opacity: 1; }

        /* â”€â”€ SCHEDULE LIST â”€â”€ */
        .schedule-list { display: flex; flex-direction: column; gap: 1rem; }
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--gray-4);
        }
        .empty-state .empty-icon { font-size: 3rem; margin-bottom: 1rem; opacity: 0.4; }
        .empty-state p { font-size: 0.9rem; }

        .schedule-item {
            border: 1.5px solid var(--gray-5);
            border-radius: 10px;
            padding: 1.1rem 1.2rem;
            transition: border-color 0.2s, box-shadow 0.2s;
            background: var(--white);
        }
        .schedule-item:hover { border-color: var(--gray-3); box-shadow: 0 2px 12px rgba(0,0,0,0.06); }
        .schedule-item.inactive { opacity: 0.7; }

        .si-top {
            display: flex; align-items: flex-start;
            justify-content: space-between; gap: 1rem;
            margin-bottom: 0.6rem;
        }
        .si-name {
            font-weight: 700; font-size: 0.97rem;
            color: var(--black);
        }
        .si-badge {
            display: inline-flex; align-items: center; gap: 4px;
            padding: 0.2rem 0.6rem;
            border-radius: 20px; font-size: 0.72rem; font-weight: 600;
            white-space: nowrap; flex-shrink: 0;
        }
        .si-badge.active { background: var(--green-light); color: var(--green); }
        .si-badge.paused { background: var(--gray-6); color: var(--gray-4); }

        .si-meta {
            font-size: 0.8rem; color: var(--gray-4);
            display: flex; flex-wrap: wrap; gap: 0.75rem;
            margin-bottom: 0.8rem;
        }
        .si-meta span { display: flex; align-items: center; gap: 4px; }

        .si-actions { display: flex; gap: 0.5rem; flex-wrap: wrap; }

        /* â”€â”€ STEP INDICATOR â”€â”€ */
        .steps {
            display: flex; align-items: center; gap: 0;
            margin-bottom: 1.8rem;
            counter-reset: step;
        }
        .step {
            display: flex; align-items: center;
            font-size: 0.8rem; color: var(--gray-4);
            gap: 6px;
        }
        .step-num {
            width: 22px; height: 22px;
            border-radius: 50%;
            background: var(--gray-5);
            color: var(--gray-3);
            display: flex; align-items: center; justify-content: center;
            font-size: 0.72rem; font-weight: 700;
            flex-shrink: 0;
        }
        .step.done .step-num  { background: var(--red); color: white; }
        .step.active .step-num { background: var(--black); color: white; }
        .step-line {
            flex: 1; height: 1.5px;
            background: var(--gray-5); margin: 0 6px;
        }
        .step-line.done { background: var(--red); }

        /* â”€â”€ INFO SECTIONS â”€â”€ */
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.2rem;
        }
        .info-item { display: flex; gap: 0.8rem; align-items: flex-start; }
        .info-icon {
            width: 36px; height: 36px; flex-shrink: 0;
            background: var(--red-light); color: var(--red);
            border-radius: 8px;
            display: flex; align-items: center; justify-content: center;
            font-size: 1rem;
        }
        .info-item h4 { font-size: 0.875rem; font-weight: 700; color: var(--black); margin-bottom: 0.2rem; }
        .info-item p { font-size: 0.8rem; color: var(--gray-4); line-height: 1.5; }

        /* â”€â”€ DIVIDER â”€â”€ */
        .divider { height: 1px; background: var(--gray-5); margin: 1.5rem 0; }

        /* â”€â”€ SECTION LABEL â”€â”€ */
        .section-label {
            font-size: 0.72rem; font-weight: 700; letter-spacing: 0.1em;
            text-transform: uppercase; color: var(--gray-4);
            margin-bottom: 0.75rem;
        }

        /* â”€â”€ API TEST â”€â”€ */
        .api-test-result {
            padding: 0.7rem 0.9rem;
            border-radius: 8px;
            font-size: 0.82rem;
            margin-top: 0.5rem;
            display: none;
        }
        .api-test-result.ok { background: var(--green-light); color: var(--green); border: 1px solid #bbf7d0; }
        .api-test-result.fail { background: var(--red-light); color: var(--red-dark); border: 1px solid #fecaca; }

        /* â”€â”€ CHANNEL TAGS â”€â”€ */
        .channel-tags {
            display: flex; flex-wrap: wrap; gap: 0.4rem;
            margin-top: 0.5rem;
        }
        .ctag {
            display: inline-flex; align-items: center; gap: 4px;
            background: var(--gray-6);
            border: 1px solid var(--gray-5);
            color: var(--gray-3);
            padding: 0.22rem 0.6rem;
            border-radius: 20px; font-size: 0.77rem; font-weight: 500;
        }

        /* â”€â”€ LIST TOP BAR â”€â”€ */
        .list-bar {
            display: flex; align-items: center; justify-content: space-between;
            margin-bottom: 1rem;
        }
        .list-count {
            font-family: var(--mono); font-size: 0.8rem; color: var(--gray-4);
        }

        /* â”€â”€ EMAIL TAG INPUT â”€â”€ */
        .email-tag-box {
            min-height: 44px;
            padding: 0.4rem 0.6rem;
            border: 1.5px solid var(--gray-5);
            border-radius: 8px;
            background: var(--white);
            cursor: text;
            display: flex; flex-wrap: wrap; gap: 0.35rem;
            align-items: center;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .email-tag-box:focus-within {
            border-color: var(--red);
            box-shadow: 0 0 0 3px rgba(230,48,48,0.1);
        }
        .email-tags { display: contents; }
        .email-tag {
            display: inline-flex; align-items: center; gap: 4px;
            background: var(--gray-6);
            border: 1px solid var(--gray-5);
            padding: 0.18rem 0.3rem 0.18rem 0.6rem;
            border-radius: 20px;
            font-size: 0.8rem; color: var(--black);
            white-space: nowrap; max-width: 220px;
            animation: fadeIn 0.15s ease;
        }
        .email-tag.invalid {
            background: var(--red-light);
            border-color: #fca5a5;
            color: var(--red-dark);
        }
        .email-tag span {
            overflow: hidden; text-overflow: ellipsis;
        }
        .email-tag-del {
            background: none; border: none; cursor: pointer;
            color: var(--gray-4); font-size: 0.75rem; padding: 1px 3px;
            border-radius: 50%; line-height: 1;
            transition: color 0.15s, background 0.15s;
            flex-shrink: 0;
        }
        .email-tag-del:hover { color: var(--red); background: #fecaca; }
        .email-tag-box input[type="email"] {
            border: none; outline: none; box-shadow: none;
            padding: 0.2rem 0.3rem;
            font-size: 0.875rem; font-family: var(--sans);
            min-width: 180px; flex: 1;
            background: transparent;
        }

        /* â”€â”€ MODAL â”€â”€ */
        .modal-overlay {
            position: fixed; inset: 0;
            background: rgba(0,0,0,0.45);
            backdrop-filter: blur(3px);
            z-index: 500;
            display: flex; align-items: center; justify-content: center;
            padding: 1.5rem;
            opacity: 0; pointer-events: none;
            transition: opacity 0.2s;
        }
        .modal-overlay.open {
            opacity: 1; pointer-events: auto;
        }
        .modal {
            background: var(--white);
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.25);
            width: 100%; max-width: 520px;
            max-height: 85vh;
            display: flex; flex-direction: column;
            transform: translateY(16px) scale(0.98);
            transition: transform 0.25s cubic-bezier(.34,1.56,.64,1);
        }
        .modal-overlay.open .modal {
            transform: translateY(0) scale(1);
        }
        .modal-header {
            padding: 1.4rem 1.6rem 1rem;
            border-bottom: 1px solid var(--gray-5);
            display: flex; align-items: flex-start; justify-content: space-between;
            flex-shrink: 0;
        }
        .modal-header h3 { font-size: 1.05rem; font-weight: 700; color: var(--black); }
        .modal-header p  { font-size: 0.8rem; color: var(--gray-4); margin-top: 0.2rem; }
        .modal-close {
            background: none; border: none;
            font-size: 1.2rem; cursor: pointer;
            color: var(--gray-4); padding: 0 0 0 1rem;
            line-height: 1; flex-shrink: 0;
        }
        .modal-close:hover { color: var(--black); }
        .modal-body {
            padding: 1.4rem 1.6rem;
            overflow-y: auto;
            flex: 1;
        }
        .modal-footer {
            padding: 1rem 1.6rem;
            border-top: 1px solid var(--gray-5);
            display: flex; gap: 0.6rem; justify-content: flex-end;
            flex-shrink: 0;
        }

        /* Channel tag editor */
        .ch-list {
            display: flex; flex-direction: column; gap: 0.45rem;
            margin-bottom: 1rem;
            max-height: 300px; overflow-y: auto;
        }
        .ch-row {
            display: flex; align-items: center; gap: 0.5rem;
            padding: 0.5rem 0.7rem;
            background: var(--gray-6);
            border: 1px solid var(--gray-5);
            border-radius: 8px;
            font-size: 0.875rem;
            animation: fadeIn 0.18s ease;
        }
        @keyframes fadeIn { from { opacity:0; transform:translateY(-4px); } to { opacity:1; transform:none; } }
        .ch-row .ch-name { flex: 1; color: var(--black); font-weight: 500; }
        .ch-del {
            background: none; border: none; cursor: pointer;
            color: var(--gray-4); font-size: 0.9rem; padding: 2px 4px;
            border-radius: 4px; transition: color 0.15s, background 0.15s;
        }
        .ch-del:hover { color: var(--red); background: var(--red-light); }

        .ch-add-row {
            display: flex; gap: 0.5rem; align-items: center;
        }
        .ch-add-row input {
            flex: 1; padding: 0.6rem 0.8rem;
            border: 1.5px solid var(--gray-5); border-radius: 8px;
            font-size: 0.875rem; font-family: var(--sans);
        }
        .ch-add-row input:focus {
            outline: none; border-color: var(--red);
            box-shadow: 0 0 0 3px rgba(230,48,48,0.1);
        }
        .ch-count {
            font-family: var(--mono); font-size: 0.75rem;
            color: var(--gray-4); margin-bottom: 0.6rem;
        }
        .ch-empty {
            text-align: center; color: var(--gray-4);
            padding: 1.5rem; font-size: 0.85rem;
        }

        /* â”€â”€ SKELETON â”€â”€ */
        .skeleton {
            background: linear-gradient(90deg, var(--gray-6) 25%, #ebebeb 50%, var(--gray-6) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.4s infinite;
            border-radius: 6px;
        }
        @keyframes shimmer { to { background-position: -200% 0; } }
        .skel-item { padding: 1.1rem 1.2rem; border: 1.5px solid var(--gray-5); border-radius: 10px; }
        .skel-line { height: 14px; margin-bottom: 8px; }
        .skel-line.short { width: 40%; }
        .skel-line.long { width: 75%; }
    </style>
</head>
<body>

<!-- HEADER -->
<header class="site-header">
    <div class="logo">
        <span class="logo-badge">YT</span>
        æ¥­é…åˆ†ææ’ç¨‹ç³»çµ±
    </div>
    <div class="header-status">
        <span class="status-dot"></span>
        ç³»çµ±é‹ä½œä¸­
    </div>
</header>

<!-- TOAST -->
<div id="toast-container"></div>

<!-- MAIN -->
<main class="page">
    <div class="page-title">
        <h1>ğŸ“Š YouTube æ¥­é…ç›£æ§ä¸­å¿ƒ</h1>
        <p>è‡ªå‹•åˆ†æé »é“æ¥­é…åˆä½œï¼Œå®šæœŸå¯„é€å ±å‘Šåˆ°ä¿¡ç®±</p>
    </div>

    <!-- TABS -->
    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('create')">ï¼‹ æ–°å¢æ’ç¨‹</button>
        <button class="tab-btn" onclick="switchTab('list')">ğŸ“‹ æ’ç¨‹ç®¡ç†</button>
        <button class="tab-btn" onclick="switchTab('guide')">ğŸ“š ä½¿ç”¨èªªæ˜</button>
    </div>

    <!-- TAB: CREATE -->
    <div class="tab-content active" id="tab-create">
        <div class="main-grid">
            <!-- FORM -->
            <div class="card">
                <div class="card-title">
                    <span class="icon">âš™ï¸</span> å»ºç«‹æ–°æ’ç¨‹
                </div>

                <div class="form-group">
                    <label>æ’ç¨‹åç¨± <span class="required">*</span></label>
                    <input type="text" id="scheduleName" placeholder="ä¾‹å¦‚ï¼šç§‘æŠ€é »é“æœˆå ±">
                </div>

                <div class="divider"></div>
                <p class="section-label">API è¨­å®š</p>

                <div class="form-group">
                    <label>YouTube Data API é‡‘é‘° <span class="required">*</span></label>
                    <div class="input-wrap">
                        <input type="password" id="apiKey" placeholder="AIza...">
                        <button class="eye-btn" onclick="togglePassword('apiKey', this)" title="é¡¯ç¤º/éš±è—é‡‘é‘°">ğŸ‘ï¸</button>
                    </div>
                    <p class="helper">å°šæœªå–å¾—é‡‘é‘°ï¼Ÿå‰å¾€ <a href="https://console.cloud.google.com/" target="_blank">Google Cloud Console</a> å»ºç«‹</p>
                </div>
                <div class="form-group">
                    <div id="apiTestResult" class="api-test-result"></div>
                    <button class="btn btn-outline btn-full" onclick="testApiKey()">
                        <span class="spinner"></span>
                        <span class="btn-text">ğŸ” é©—è­‰ API é‡‘é‘°</span>
                    </button>
                </div>

                <div class="divider"></div>
                <p class="section-label">ç›£æ§è¨­å®š</p>

                <div class="form-group">
                    <label>ç›£æ§é »é“ <span class="required">*</span></label>
                    <textarea id="channels" placeholder="æ¯è¡Œè¼¸å…¥ä¸€å€‹é »é“åç¨±ï¼Œä¾‹å¦‚ï¼š&#10;å¿—ç¥ºä¸ƒä¸ƒ&#10;é˜¿æ»´è‹±æ–‡&#10;ç†ç§‘å¤ªå¤ª" oninput="updateChannelTags()"></textarea>
                    <p class="helper">æ¯è¡Œä¸€å€‹é »é“åç¨±</p>
                    <div class="channel-tags" id="channelTags"></div>
                </div>

                <div class="row-2">
                    <div class="form-group">
                        <label>æœå°‹æœŸé–“</label>
                        <select id="weeks">
                            <option value="1">è¿‘ 1 é€±</option>
                            <option value="2">è¿‘ 2 é€±</option>
                            <option value="4" selected>è¿‘ 4 é€±</option>
                            <option value="8">è¿‘ 8 é€±</option>
                            <option value="12">è¿‘ 12 é€±</option>
                            <option value="26">è¿‘ 26 é€±ï¼ˆåŠå¹´ï¼‰</option>
                            <option value="52">è¿‘ 52 é€±ï¼ˆä¸€å¹´ï¼‰</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>å ±å‘Šé »ç‡</label>
                        <select id="frequency">
                            <option value="daily">æ¯æ—¥</option>
                            <option value="weekly" selected>æ¯é€±</option>
                            <option value="monthly">æ¯æœˆ</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label>ç™¼é€æ™‚é–“</label>
                    <input type="time" id="sendTime" value="09:00">
                    <p class="helper">å ±å‘Šå°‡åœ¨æ¯å€‹æ’ç¨‹é€±æœŸçš„æ­¤æ™‚é–“å¯„å‡º</p>
                </div>

                <div class="divider"></div>
                <p class="section-label">æ”¶ä»¶è¨­å®š</p>

                <div class="form-group">
                    <label>æ”¶ä»¶éƒµç®± <span class="required">*</span></label>
                    <div class="email-tag-box" id="emailTagBox" onclick="document.getElementById('emailInput').focus()">
                        <div class="email-tags" id="emailTags"></div>
                        <input type="email" id="emailInput" placeholder="è¼¸å…¥ä¿¡ç®±å¾ŒæŒ‰ Enter æˆ–ç©ºæ ¼æ–°å¢"
                               onkeydown="handleEmailKey(event)"
                               onblur="commitEmailInput()"
                               oninput="updatePreview()">
                    </div>
                    <p class="helper">å¯æ–°å¢å¤šä½æ”¶ä»¶äººï¼Œå ±å‘Šå°‡åŒæ™‚å¯„é€çµ¦æ‰€æœ‰äºº</p>
                </div>

                <button class="btn btn-primary btn-full" id="createBtn" onclick="createSchedule()">
                    <span class="spinner"></span>
                    <span class="btn-text">ğŸš€ å»ºç«‹æ’ç¨‹</span>
                </button>
            </div>

            <!-- SIDE INFO -->
            <div style="display:flex; flex-direction:column; gap:1.2rem;">
                <!-- PREVIEW CARD -->
                <div class="card">
                    <div class="card-title">
                        <span class="icon">ğŸ‘ï¸</span> æ’ç¨‹é è¦½
                    </div>
                    <div id="previewContent" style="font-size:0.875rem; color:var(--gray-4); line-height:1.8;">
                        å¡«å¯«å·¦å´è¡¨å–®å¾Œï¼Œé è¦½å°‡åœ¨æ­¤é¡¯ç¤º
                    </div>
                </div>

                <!-- TIPS -->
                <div class="card">
                    <div class="card-title">
                        <span class="icon">ğŸ’¡</span> å°æé†’
                    </div>
                    <ul style="font-size:0.85rem; color:var(--gray-3); line-height:1.8; padding-left:1.2rem;">
                        <li>é¦–æ¬¡åŸ·è¡Œæœƒåœ¨ä¸‹ä¸€å€‹æ’ç¨‹æ™‚é–“å¯„å‡º</li>
                        <li>å¯éš¨æ™‚ä½¿ç”¨ã€Œç«‹å³åˆ†æã€è§¸ç™¼å³æ™‚å ±å‘Š</li>
                        <li>API é‡‘é‘°æ¯æ—¥æœ‰é…é¡é™åˆ¶ï¼Œè«‹ç•™æ„ä½¿ç”¨é‡</li>
                        <li>å ±å‘Šæ ¼å¼ç‚º CSVï¼Œå¯ç”¨ Excel é–‹å•Ÿ</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- TAB: LIST -->
    <div class="tab-content" id="tab-list">
        <div class="card">
            <div class="list-bar">
                <div class="card-title" style="margin:0;">
                    <span class="icon">ğŸ“‹</span> æˆ‘çš„æ’ç¨‹
                </div>
                <div style="display:flex; gap:0.5rem; align-items:center;">
                    <span class="list-count" id="scheduleCount">â€”</span>
                    <button class="btn btn-outline btn-sm" onclick="loadSchedules()">â†» é‡æ–°æ•´ç†</button>
                </div>
            </div>
            <div id="scheduleList">
                <!-- skeleton -->
                <div class="schedule-list">
                    <div class="skel-item">
                        <div class="skeleton skel-line short"></div>
                        <div class="skeleton skel-line long"></div>
                    </div>
                    <div class="skel-item" style="margin-top:1rem;">
                        <div class="skeleton skel-line short"></div>
                        <div class="skeleton skel-line long"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- TAB: GUIDE -->
    <div class="tab-content" id="tab-guide">
        <div class="card">
            <div class="card-title">
                <span class="icon">ğŸ“š</span> ä½¿ç”¨èªªæ˜
            </div>
            <!-- STEPS -->
            <div class="steps">
                <div class="step done">
                    <span class="step-num">1</span>
                    <span>å–å¾— API é‡‘é‘°</span>
                </div>
                <div class="step-line done"></div>
                <div class="step active">
                    <span class="step-num">2</span>
                    <span>å»ºç«‹æ’ç¨‹</span>
                </div>
                <div class="step-line"></div>
                <div class="step">
                    <span class="step-num">3</span>
                    <span>ç­‰å€™å ±å‘Š</span>
                </div>
                <div class="step-line"></div>
                <div class="step">
                    <span class="step-num">4</span>
                    <span>æŸ¥çœ‹åˆ†æ</span>
                </div>
            </div>

            <div class="info-grid">
                <div class="info-item">
                    <span class="info-icon">ğŸ”</span>
                    <div>
                        <h4>è‡ªå‹•ç›£æ§</h4>
                        <p>ç³»çµ±ä¾ç…§è¨­å®šé »ç‡ï¼Œè‡ªå‹•æƒæé »é“çš„æ¥­é…å½±ç‰‡ï¼ŒåŒ…å«æ¥­é…é€£çµã€å“ç‰Œåˆä½œè³‡è¨Š</p>
                    </div>
                </div>
                <div class="info-item">
                    <span class="info-icon">ğŸ“§</span>
                    <div>
                        <h4>éƒµä»¶å ±å‘Š</h4>
                        <p>åˆ†æå®Œæˆå¾Œå¯„é€ CSV æ ¼å¼å ±å‘Šï¼Œæ¸…å–®åŒ…å«å½±ç‰‡æ¨™é¡Œã€ç™¼å¸ƒæ™‚é–“ã€æ¥­é…å“ç‰Œ</p>
                    </div>
                </div>
                <div class="info-item">
                    <span class="info-icon">âš™ï¸</span>
                    <div>
                        <h4>å½ˆæ€§ç®¡ç†</h4>
                        <p>å¯éš¨æ™‚æš«åœã€æ¢å¾©ã€åˆªé™¤æ’ç¨‹ï¼Œæˆ–æ‰‹å‹•è§¸ç™¼ç«‹å³åˆ†æ</p>
                    </div>
                </div>
                <div class="info-item">
                    <span class="info-icon">ğŸ”’</span>
                    <div>
                        <h4>å®‰å…¨å„²å­˜</h4>
                        <p>API é‡‘é‘°èˆ‡å€‹äººè³‡æ–™ç¶“åŠ å¯†å¾Œå„²å­˜ï¼Œä¸æœƒæ˜æ–‡å‚³è¼¸</p>
                    </div>
                </div>
                <div class="info-item">
                    <span class="info-icon">ğŸ“Š</span>
                    <div>
                        <h4>å¤šé »é“æ”¯æ´</h4>
                        <p>å–®ä¸€æ’ç¨‹å¯ç›£æ§ç„¡é™æ•¸é‡çš„é »é“ï¼Œä¹Ÿå¯éš¨æ™‚ç‚ºç¾æœ‰æ’ç¨‹æ–°å¢æˆ–ç§»é™¤é »é“</p>
                    </div>
                </div>
                <div class="info-item">
                    <span class="info-icon">ğŸ•</span>
                    <div>
                        <h4>è‡ªè¨‚æ’ç¨‹</h4>
                        <p>æ¯æ—¥ã€æ¯é€±ã€æ¯æœˆä¸‰ç¨®é »ç‡ï¼Œæ­é…è‡ªè¨‚ç™¼é€æ™‚é–“ï¼Œå®Œå…¨è²¼åˆä½ çš„å·¥ä½œç¯€å¥</p>
                    </div>
                </div>
            </div>

            <div class="divider"></div>
            <p class="section-label">å¦‚ä½•å–å¾— YouTube Data API é‡‘é‘°</p>
            <ol style="font-size:0.875rem; color:var(--gray-3); line-height:2; padding-left:1.4rem;">
                <li>å‰å¾€ <a href="https://console.cloud.google.com/" target="_blank" style="color:var(--blue);">Google Cloud Console</a> ä¸¦ç™»å…¥å¸³è™Ÿ</li>
                <li>å»ºç«‹æ–°å°ˆæ¡ˆæˆ–é¸æ“‡ç¾æœ‰å°ˆæ¡ˆ</li>
                <li>å‰å¾€ã€ŒAPI å’Œæœå‹™ã€â†’ã€Œç¨‹å¼åº«ã€ï¼Œæœå°‹ä¸¦å•Ÿç”¨ã€ŒYouTube Data API v3ã€</li>
                <li>å‰å¾€ã€ŒAPI å’Œæœå‹™ã€â†’ã€Œæ†‘è­‰ã€ï¼Œé»æ“Šã€Œå»ºç«‹æ†‘è­‰ã€â†’ã€ŒAPI é‡‘é‘°ã€</li>
                <li>è¤‡è£½é‡‘é‘°ä¸¦è²¼å…¥æœ¬ç³»çµ±çš„ã€ŒAPI é‡‘é‘°ã€æ¬„ä½</li>
            </ol>
        </div>
    </div>
</main>

<!-- â”€â”€ EDIT CHANNELS MODAL â”€â”€ -->
<div class="modal-overlay" id="editModal" onclick="closeModalOnOverlay(event)">
    <div class="modal">
        <div class="modal-header">
            <div>
                <h3>âœï¸ ç·¨è¼¯é »é“æ¸…å–®</h3>
                <p id="editModalSubtitle">æ’ç¨‹ï¼šâ€”</p>
            </div>
            <button class="modal-close" onclick="closeEditModal()">âœ•</button>
        </div>
        <div class="modal-body">
            <div class="ch-count" id="chCount">0 å€‹é »é“</div>
            <div class="ch-list" id="chList">
                <div class="ch-empty">è¼‰å…¥ä¸­â€¦</div>
            </div>
            <div class="section-label" style="margin-bottom:0.5rem;">æ–°å¢é »é“</div>
            <div class="ch-add-row">
                <input type="text" id="newChannelInput" placeholder="è¼¸å…¥é »é“åç¨±" 
                       onkeydown="if(event.key==='Enter') addChannel()">
                <button class="btn btn-primary btn-sm" onclick="addChannel()">ï¼‹ æ–°å¢</button>
            </div>
            <p style="font-size:0.77rem;color:var(--gray-4);margin-top:0.4rem;">æŒ‰ Enter æˆ–é»æ“Šæ–°å¢æŒ‰éˆ•ï¼Œæ”¯æ´ç„¡é™æ•¸é‡é »é“</p>
        </div>
        <div class="modal-footer">
            <button class="btn btn-outline btn-sm" onclick="closeEditModal()">å–æ¶ˆ</button>
            <button class="btn btn-primary btn-sm" id="saveChannelsBtn" onclick="saveChannels()">
                <span class="spinner"></span>
                <span class="btn-text">ğŸ’¾ å„²å­˜è®Šæ›´</span>
            </button>
        </div>
    </div>
</div>

<script>
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  CONFIG
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const API_URL = '/api';

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  TABS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function switchTab(name) {
        document.querySelectorAll('.tab-btn').forEach((b, i) => {
            const names = ['create','list','guide'];
            b.classList.toggle('active', names[i] === name);
        });
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        document.getElementById('tab-' + name).classList.add('active');
        if (name === 'list') loadSchedules();
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  TOAST
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function showToast(message, type = 'success', duration = 4500) {
        const icons = { success: 'âœ…', error: 'âŒ', info: 'â„¹ï¸' };
        const container = document.getElementById('toast-container');
        const el = document.createElement('div');
        el.className = `toast toast-${type}`;
        el.innerHTML = `
            <span class="toast-icon">${icons[type] || 'â„¹ï¸'}</span>
            <span class="toast-msg">${message}</span>
            <button class="toast-close" onclick="this.closest('.toast').remove()">âœ•</button>
        `;
        container.appendChild(el);
        setTimeout(() => el.remove(), duration);
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  UTILS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function togglePassword(id, btn) {
        const el = document.getElementById(id);
        if (el.type === 'password') { el.type = 'text'; btn.textContent = 'ğŸ™ˆ'; }
        else { el.type = 'password'; btn.textContent = 'ğŸ‘ï¸'; }
    }

    function setLoading(btn, loading) {
        btn.classList.toggle('loading', loading);
        btn.disabled = loading;
    }

    function getFrequencyLabel(f) {
        return { daily:'æ¯æ—¥', weekly:'æ¯é€±', monthly:'æ¯æœˆ' }[f] || f;
    }

    function getChannels() {
        return (document.getElementById('channels').value || '')
            .split('\n').map(c => c.trim()).filter(Boolean);
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  LIVE PREVIEW
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function updatePreview() {
        const name      = document.getElementById('scheduleName')?.value.trim();
        const email     = getEmails().join(', ') || document.getElementById('emailInput')?.value.trim();
        const freq      = document.getElementById('frequency')?.value;
        const time      = document.getElementById('sendTime')?.value;
        const weeks     = document.getElementById('weeks')?.value;
        const channels  = getChannels();

        if (!name && !email && channels.length === 0) {
            document.getElementById('previewContent').innerHTML =
                '<span style="color:var(--gray-5);">å¡«å¯«å·¦å´è¡¨å–®å¾Œï¼Œé è¦½å°‡åœ¨æ­¤é¡¯ç¤º</span>';
            return;
        }
        document.getElementById('previewContent').innerHTML = `
            <div style="display:flex; flex-direction:column; gap:0.7rem;">
                <div><strong style="color:var(--black);">ğŸ“Œ æ’ç¨‹åç¨±</strong><br>${name || '<em style="color:var(--gray-4)">æœªå¡«å¯«</em>'}</div>
                <div><strong style="color:var(--black);">ğŸ“¡ ç›£æ§é »é“</strong><br>${channels.length > 0 ? channels.map(c=>`<span style="background:var(--gray-6);border:1px solid var(--gray-5);padding:1px 8px;border-radius:20px;font-size:0.8rem;display:inline-block;margin:2px 2px 2px 0;">${c}</span>`).join('') : '<em style="color:var(--gray-4)">æœªå¡«å¯«</em>'}</div>
                <div><strong style="color:var(--black);">ğŸ“… ç™¼é€é »ç‡</strong><br>${getFrequencyLabel(freq)} â€” ${time || '09:00'}</div>
                <div><strong style="color:var(--black);">ğŸ—“ï¸ æœå°‹ç¯„åœ</strong><br>è¿‘ ${weeks || 4} é€±</div>
                <div><strong style="color:var(--black);">ğŸ“§ æ”¶ä»¶éƒµç®±</strong><br>${email ? email.split(', ').map(e => `<span style="background:var(--gray-6);border:1px solid var(--gray-5);padding:1px 8px;border-radius:20px;font-size:0.8rem;display:inline-block;margin:2px 2px 2px 0;">${e}</span>`).join('') : '<em style="color:var(--gray-4)">æœªå¡«å¯«</em>'}</div>
            </div>
        `;
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  CHANNEL TAGS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function updateChannelTags() {
        const channels = getChannels();
        const container = document.getElementById('channelTags');
        if (channels.length === 0) { container.innerHTML = ''; return; }
        container.innerHTML = channels.map(c =>
            `<span class="ctag">ğŸ¬ ${c}</span>`
        ).join('');
        updatePreview();
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  TEST API KEY
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function testApiKey() {
        const key = document.getElementById('apiKey').value.trim();
        const resultEl = document.getElementById('apiTestResult');
        const btn = event.currentTarget;

        if (!key) { showToast('è«‹å…ˆå¡«å…¥ API é‡‘é‘°', 'error'); return; }

        setLoading(btn, true);
        resultEl.style.display = 'none';

        try {
            const res = await fetch(`${API_URL}/test-key`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ apiKey: key })
            });
            const data = await res.json();
            if (res.ok && data.valid) {
                resultEl.className = 'api-test-result ok';
                resultEl.textContent = 'âœ… API é‡‘é‘°é©—è­‰æˆåŠŸï¼';
            } else {
                resultEl.className = 'api-test-result fail';
                resultEl.textContent = 'âŒ ' + (data.message || 'API é‡‘é‘°ç„¡æ•ˆï¼Œè«‹ç¢ºèªå¾Œå†è©¦');
            }
        } catch (e) {
            resultEl.className = 'api-test-result fail';
            resultEl.textContent = 'âš ï¸ ç„¡æ³•é€£ç·šè‡³ä¼ºæœå™¨';
        } finally {
            resultEl.style.display = 'block';
            setLoading(btn, false);
        }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  CREATE SCHEDULE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function createSchedule() {
        const schedule = {
            name:      document.getElementById('scheduleName').value.trim(),
            apiKey:    document.getElementById('apiKey').value.trim(),
            channels:  getChannels(),
            weeks:     parseInt(document.getElementById('weeks').value),
            frequency: document.getElementById('frequency').value,
            sendTime:  document.getElementById('sendTime').value,
            emails:    getEmails()
        };

        if (!schedule.name)                    { showToast('è«‹å¡«å¯«æ’ç¨‹åç¨±', 'error'); return; }
        if (!schedule.apiKey)                  { showToast('è«‹å¡«å¯« API é‡‘é‘°', 'error'); return; }
        if (schedule.channels.length === 0)    { showToast('è«‹è‡³å°‘è¼¸å…¥ä¸€å€‹é »é“', 'error'); return; }
        if (schedule.emails.length === 0)             { showToast('è«‹è‡³å°‘å¡«å¯«ä¸€å€‹æ”¶ä»¶éƒµç®±', 'error'); return; }

        const btn = document.getElementById('createBtn');
        setLoading(btn, true);

        try {
            const res = await fetch(`${API_URL}/schedules`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(schedule)
            });

            if (res.ok) {
                showToast('ğŸ‰ æ’ç¨‹å»ºç«‹æˆåŠŸï¼é¦–æ¬¡å ±å‘Šå°‡åœ¨ä¸‹æ¬¡æ’ç¨‹æ™‚é–“å¯„å‡º', 'success');
                document.getElementById('scheduleName').value = '';
                document.getElementById('channels').value = '';
                document.getElementById('channelTags').innerHTML = '';
                document.getElementById('emailTags').innerHTML = '';
                document.getElementById('emailInput').value = '';
                _emails = [];
                updatePreview();
            } else {
                const err = await res.json().catch(() => ({}));
                showToast('å»ºç«‹å¤±æ•—ï¼š' + (err.message || 'æœªçŸ¥éŒ¯èª¤'), 'error');
            }
        } catch (e) {
            showToast('âš ï¸ ç„¡æ³•é€£ç·šè‡³ä¼ºæœå™¨ï¼Œè«‹ç¢ºèªå¾Œç«¯æœå‹™æ˜¯å¦æ­£å¸¸', 'error');
        } finally {
            setLoading(btn, false);
        }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  LOAD SCHEDULES
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function loadSchedules() {
        const listDiv = document.getElementById('scheduleList');
        listDiv.innerHTML = `
            <div class="schedule-list">
                ${[1,2].map(() => `<div class="skel-item">
                    <div class="skeleton skel-line short"></div>
                    <div class="skeleton skel-line long"></div>
                </div>`).join('')}
            </div>`;
        document.getElementById('scheduleCount').textContent = 'â€”';

        try {
            const res = await fetch(`${API_URL}/schedules`);
            const schedules = await res.json();

            document.getElementById('scheduleCount').textContent = `å…± ${schedules.length} ç­†`;

            if (schedules.length === 0) {
                listDiv.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">ğŸ“­</div>
                        <p>å°šæœªå»ºç«‹ä»»ä½•æ’ç¨‹<br>å‰å¾€ã€Œæ–°å¢æ’ç¨‹ã€é–‹å§‹ä½¿ç”¨</p>
                        <button class="btn btn-primary" style="margin-top:1rem;" onclick="switchTab('create')">å»ºç«‹ç¬¬ä¸€å€‹æ’ç¨‹</button>
                    </div>`;
                return;
            }

            listDiv.innerHTML = `<div class="schedule-list">${
                schedules.map(s => `
                    <div class="schedule-item ${s.active ? '' : 'inactive'}" id="si-${s.id}">
                        <div class="si-top">
                            <div class="si-name">${escapeHtml(s.name)}</div>
                            <span class="si-badge ${s.active ? 'active' : 'paused'}">
                                ${s.active ? 'â— åŸ·è¡Œä¸­' : 'â¸ å·²æš«åœ'}
                            </span>
                        </div>
                        <div class="si-meta">
                            <span>ğŸ¬ ${s.channels?.length || 0} å€‹é »é“</span>
                            <span>ğŸ“… ${getFrequencyLabel(s.frequency)}</span>
                            <span>ğŸ• ${s.sendTime || '09:00'}</span>
                            <span>ğŸ“§ ${Array.isArray(s.emails) ? s.emails.length + ' ä½æ”¶ä»¶äºº' : escapeHtml(s.email || s.emails || '')}</span>
                        </div>
                        <div class="si-actions">
                            <button class="btn btn-primary btn-sm" onclick="runNow('${s.id}')">â–¶ ç«‹å³åˆ†æ</button>
                            <button class="btn btn-outline btn-sm" onclick="openEditModal('${s.id}', ${JSON.stringify(s.channels || []).replace(/"/g, '&quot;')}, '${escapeHtml(s.name)}')">âœï¸ ç·¨è¼¯é »é“</button>
                            <button class="btn ${s.active ? 'btn-outline' : 'btn-success'} btn-sm"
                                    onclick="toggleSchedule('${s.id}', ${s.active})">
                                ${s.active ? 'â¸ æš«åœ' : 'â–¶ å•Ÿç”¨'}
                            </button>
                            <button class="btn btn-ghost btn-sm" onclick="deleteSchedule('${s.id}')">ğŸ—‘ åˆªé™¤</button>
                        </div>
                    </div>
                `).join('')
            }</div>`;
        } catch (e) {
            listDiv.innerHTML = `
                <div class="empty-state">
                    <div class="empty-icon">âš ï¸</div>
                    <p>ç„¡æ³•é€£ç·šè‡³ä¼ºæœå™¨<br><small style="color:var(--gray-4);">${e.message}</small></p>
                    <button class="btn btn-outline" style="margin-top:1rem;" onclick="loadSchedules()">é‡è©¦</button>
                </div>`;
            document.getElementById('scheduleCount').textContent = 'é€£ç·šå¤±æ•—';
        }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  RUN NOW
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function runNow(id) {
        if (!confirm('ç¢ºå®šç«‹å³åŸ·è¡Œåˆ†æï¼Ÿ\nç³»çµ±å°‡é–‹å§‹æƒæä¸¦å¯„é€ CSV å ±å‘Šåˆ°ä¿¡ç®±')) return;
        showToast('â³ åˆ†æä»»å‹™å·²å•Ÿå‹•ï¼Œè«‹ç•™æ„ä¿¡ç®±â€¦', 'info');
        try {
            const res = await fetch(`${API_URL}/schedules/${id}/run`, { method: 'POST' });
            const data = await res.json().catch(() => ({}));
            showToast(data.message || 'âœ… ä»»å‹™å·²è§¸ç™¼', res.ok ? 'success' : 'error');
        } catch (e) {
            showToast('åŸ·è¡Œå¤±æ•—ï¼š' + e.message, 'error');
        }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  TOGGLE SCHEDULE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function toggleSchedule(id, current) {
        try {
            const res = await fetch(`${API_URL}/schedules/${id}/toggle`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ active: !current })
            });
            if (res.ok) {
                showToast(current ? 'å·²æš«åœæ’ç¨‹' : 'æ’ç¨‹å·²å•Ÿç”¨', 'success');
                loadSchedules();
            } else {
                showToast('æ“ä½œå¤±æ•—', 'error');
            }
        } catch (e) {
            showToast('åˆ‡æ›å¤±æ•—ï¼š' + e.message, 'error');
        }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  DELETE SCHEDULE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    async function deleteSchedule(id) {
        if (!confirm('ç¢ºå®šè¦æ°¸ä¹…åˆªé™¤æ­¤æ’ç¨‹å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸ')) return;
        try {
            const res = await fetch(`${API_URL}/schedules/${id}`, { method: 'DELETE' });
            if (res.ok) {
                showToast('å·²åˆªé™¤æ’ç¨‹', 'success');
                loadSchedules();
            } else {
                showToast('åˆªé™¤å¤±æ•—', 'error');
            }
        } catch (e) {
            showToast('åˆªé™¤å¤±æ•—ï¼š' + e.message, 'error');
        }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  EDIT CHANNELS MODAL
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    let _editId = null;
    let _editChannels = [];

    function openEditModal(id, channelsJson, name) {
        _editId = id;
        try {
            _editChannels = typeof channelsJson === 'string'
                ? JSON.parse(channelsJson.replace(/&quot;/g, '"'))
                : channelsJson;
        } catch(e) { _editChannels = []; }
        _editChannels = [..._editChannels];

        document.getElementById('editModalSubtitle').textContent = 'æ’ç¨‹ï¼š' + name;
        document.getElementById('newChannelInput').value = '';
        renderChList();
        document.getElementById('editModal').classList.add('open');
        document.body.style.overflow = 'hidden';
        setTimeout(() => document.getElementById('newChannelInput').focus(), 250);
    }

    function closeEditModal() {
        document.getElementById('editModal').classList.remove('open');
        document.body.style.overflow = '';
        _editId = null;
        _editChannels = [];
    }

    function closeModalOnOverlay(e) {
        if (e.target === document.getElementById('editModal')) closeEditModal();
    }

    function renderChList() {
        const list = document.getElementById('chList');
        const count = document.getElementById('chCount');
        count.textContent = `${_editChannels.length} å€‹é »é“`;
        if (_editChannels.length === 0) {
            list.innerHTML = '<div class="ch-empty">å°šç„¡é »é“ï¼Œè«‹åœ¨ä¸‹æ–¹æ–°å¢</div>';
            return;
        }
        list.innerHTML = _editChannels.map((ch, i) => `
            <div class="ch-row">
                <span class="ch-name">ğŸ¬ ${escapeHtml(ch)}</span>
                <button class="ch-del" onclick="removeChannel(${i})" title="ç§»é™¤">âœ•</button>
            </div>
        `).join('');
    }

    function addChannel() {
        const input = document.getElementById('newChannelInput');
        const val = input.value.trim();
        if (!val) { input.focus(); return; }
        if (_editChannels.includes(val)) {
            showToast('æ­¤é »é“å·²å­˜åœ¨æ¸…å–®ä¸­', 'error');
            input.select();
            return;
        }
        _editChannels.push(val);
        input.value = '';
        input.focus();
        renderChList();
        const list = document.getElementById('chList');
        list.scrollTop = list.scrollHeight;
    }

    function removeChannel(index) {
        _editChannels.splice(index, 1);
        renderChList();
    }

    async function saveChannels() {
        if (!_editId) return;
        if (_editChannels.length === 0) {
            showToast('æ’ç¨‹è‡³å°‘éœ€è¦ä¸€å€‹é »é“', 'error');
            return;
        }
        const btn = document.getElementById('saveChannelsBtn');
        setLoading(btn, true);
        try {
            const res = await fetch(`${API_URL}/schedules/${_editId}/channels`, {
                method: 'PATCH',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ channels: _editChannels })
            });
            if (res.ok) {
                showToast(`âœ… é »é“æ¸…å–®å·²æ›´æ–°ï¼ˆå…± ${_editChannels.length} å€‹é »é“ï¼‰`, 'success');
                closeEditModal();
                loadSchedules();
            } else {
                const err = await res.json().catch(() => ({}));
                showToast('å„²å­˜å¤±æ•—ï¼š' + (err.message || 'æœªçŸ¥éŒ¯èª¤'), 'error');
            }
        } catch (e) {
            showToast('âš ï¸ ç„¡æ³•é€£ç·šè‡³ä¼ºæœå™¨', 'error');
        } finally {
            setLoading(btn, false);
        }
    }

    document.addEventListener('keydown', e => {
        if (e.key === 'Escape') closeEditModal();
    });

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  EMAIL TAG INPUT
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    let _emails = [];

    const EMAIL_RE = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

    function getEmails() { return [..._emails]; }

    function renderEmailTags() {
        const container = document.getElementById('emailTags');
        container.innerHTML = _emails.map((em, i) => `
            <span class="email-tag ${EMAIL_RE.test(em) ? '' : 'invalid'}" title="${escapeHtml(em)}">
                <span>${escapeHtml(em)}</span>
                <button class="email-tag-del" onclick="removeEmail(${i})" tabindex="-1">âœ•</button>
            </span>
        `).join('');
        updatePreview();
    }

    function handleEmailKey(e) {
        if (e.key === 'Enter' || e.key === ' ' || e.key === ',') {
            e.preventDefault();
            commitEmailInput();
        } else if (e.key === 'Backspace' && e.target.value === '' && _emails.length > 0) {
            _emails.pop();
            renderEmailTags();
        }
    }

    function commitEmailInput() {
        const input = document.getElementById('emailInput');
        const val = input.value.trim().replace(/,/g, '');
        if (!val) return;
        if (_emails.includes(val)) {
            showToast('æ­¤ä¿¡ç®±å·²åœ¨æ¸…å–®ä¸­', 'error');
            input.value = '';
            return;
        }
        if (!EMAIL_RE.test(val)) {
            showToast('ã€Œ' + val + 'ã€æ ¼å¼ä¸æ­£ç¢º', 'error');
            return;
        }
        _emails.push(val);
        input.value = '';
        renderEmailTags();
    }

    function removeEmail(index) {
        _emails.splice(index, 1);
        renderEmailTags();
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  HELPERS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function escapeHtml(str) {
        return (str || '').replace(/[&<>"']/g, c =>
            ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  LIVE PREVIEW BINDINGS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    ['scheduleName','apiKey','weeks','frequency','sendTime'].forEach(id => {
        const el = document.getElementById(id);
        if (el) el.addEventListener('input', updatePreview);
    });

    // Init
    window.addEventListener('load', () => {
        updatePreview();
        // é å…ˆè¼‰å…¥æ’ç¨‹æ•¸é‡é¡¯ç¤ºåœ¨ tab ä¸Šä¸éœ€ç‰¹åˆ¥è™•ç†
    });
</script>
</body>
</html>
